<html>
<head>
<meta charset="UTF-8">
<title>ZFTS Health Check</title>
<link rel="stylesheet" href="stats.css">
<style>
body {
  font-family: Arial, sans-serif;
  background-color: var(--bg);
  color: var(--fg);
  margin: 30px;
}
:root {
  --bg:#f8f9fa;
  --fg:#222;
}
.dark {
  --bg:#121212;
  --fg:#eee;
}
button {
  padding:8px 14px;
  border:none;
  border-radius:4px;
  background-color:#1589ff;
  color:white;
  cursor:pointer;
}
button:hover { background-color:#0f6ed0; }
#result {
  margin-top:15px;
  padding:10px;
  border-radius:4px;
  background:#e9ecef;
  color:#111;
}
</style>
</head>
<body>
  <h1>Ground â†”â€¯Air Connectivityâ€¯Health</h1>
  <label for="airIP"><strong>Airâ€¯Host/IP</strong></label>
  <input type="text" id="airIP" placeholder="192.168.10.213">
  <button onclick="checkHealth()">Checkâ€¯Connection</button>
  <button onclick="window.location='index.html'">Returnâ€¯toâ€¯Dashboard</button>
  <button id="themeToggle" style="float:right">ğŸŒ™â€¯Dark</button>
  <div id="result"></div>

<script>
const resBox = document.getElementById('result');
const themeBtn = document.getElementById('themeToggle');

// --- Darkâ€‘mode toggle ---
themeBtn.onclick = () => {
  document.body.classList.toggle('dark');
  const dark = document.body.classList.contains('dark');
  themeBtn.textContent = dark ? 'â˜€ï¸â€¯Light' : 'ğŸŒ™â€¯Dark';
  localStorage.setItem('darkMode', dark);
};

// restore previous theme
window.onload = () => {
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark');
    themeBtn.textContent = 'â˜€ï¸â€¯Light';
  }
};

// --- Health check ---
async function checkHealth() {
  const ip = document.getElementById("airIP").value.trim();
  if (!ip) {
    resBox.textContent = "Please enter an Air IP address.";
    return;
  }
  resBox.textContent = "Testing connectivity...";
  const url = `/airproxy?target=${ip}:19712&path=files`;
  try {
    const r = await fetch(url);
    if (!r.ok) throw new Error(r.statusText);
    const data = await r.json();
    resBox.style.background = '#d4edda';
    resBox.innerHTML =
      `âœ…â€¯Connected toâ€¯${data.platform_name || ip}<br>` +
      `<pre>${JSON.stringify(data, null, 2)}</pre>`;
  } catch (err) {
    resBox.style.background = '#f8d7da';
    resBox.textContent = `âŒâ€¯Connection failed: ${err.message}`;
  }
}
</script>
</body>
</html>
